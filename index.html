<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imalink Desktop</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <main class="container">
      <h1>Imalink Desktop</h1>
      <p>Batch import av bilder til Imalink backend via imalink-core</p>

      <!-- Login Screen -->
      <div id="login-screen" style="display: none;">
        <div class="section">
          <h2>Logg inn</h2>
          <form id="login-form">
            <div class="controls">
              <label for="backend-url">Imalink Backend URL:</label>
              <input 
                type="text" 
                id="backend-url" 
                value="https://api.trollfjell.com" 
                placeholder="https://api.trollfjell.com"
              />
            </div>
            <div class="controls">
              <label for="login-username">Brukernavn:</label>
              <input 
                type="text" 
                id="login-username" 
                placeholder="brukernavn"
                autocomplete="username"
                required
              />
            </div>
            <div class="controls">
              <label for="login-password">Passord:</label>
              <input 
                type="password" 
                id="login-password" 
                placeholder="passord"
                autocomplete="current-password"
                required
              />
            </div>
            <div class="controls">
              <button type="submit" id="login-btn">Logg inn</button>
            </div>
            <div id="login-status"></div>
            <div class="auth-toggle">
              <p>Har du ikke konto? <a href="#" id="show-register">Registrer deg her</a></p>
            </div>
          </form>
        </div>

        <div class="section">
          <h2>Registrer ny bruker</h2>
          <form id="register-form" style="display: none;">
            <div class="controls">
              <label for="register-username">Brukernavn:</label>
              <input 
                type="text" 
                id="register-username" 
                placeholder="brukernavn"
                autocomplete="username"
                required
              />
            </div>
            <div class="controls">
              <label for="register-email">E-post:</label>
              <input 
                type="email" 
                id="register-email" 
                placeholder="din@epost.no"
                autocomplete="email"
                required
              />
            </div>
            <div class="controls">
              <label for="register-password">Passord:</label>
              <input 
                type="password" 
                id="register-password" 
                placeholder="passord"
                autocomplete="new-password"
                required
              />
            </div>
            <div class="controls">
              <label for="register-displayname">Visningsnavn:</label>
              <input 
                type="text" 
                id="register-displayname" 
                placeholder="Ditt Navn"
                required
              />
            </div>
            <div class="controls">
              <button type="submit" id="register-btn">Registrer bruker</button>
            </div>
            <div id="register-status"></div>
            <div class="auth-toggle">
              <p>Har du allerede konto? <a href="#" id="show-login">Logg inn her</a></p>
            </div>
          </form>
        </div>
      </div>

      <!-- Main Screen (after login) -->
      <div id="main-screen" style="display: none;">
        <div class="section">
          <div class="user-header">
            <span id="user-info"></span>
            <button id="open-gallery-btn" class="gallery-btn">游닞 칀pne Galleri</button>
            <button id="logout-btn" class="logout-btn">Logg ut</button>
          </div>
        </div>

        <div class="section">
          <h2>1. API Konfiguration</h2>
          <div class="controls">
            <label for="core-url">imalink-core API URL:</label>
            <input 
              type="text" 
              id="core-url" 
              value="http://localhost:8765" 
              placeholder="http://localhost:8765"
            />
            <p class="info-text">丘멆잺 imalink-core m친 kj칮re lokalt p친 port 8765. Start med: <code>uv run imalink-core</code></p>
          </div>
        </div>

        <div class="section">
          <h2>2. Input Channel</h2>
          <div class="controls">
            <label>Velg eksisterende eller opprett ny:</label>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button id="load-channels-btn" type="button">Last inn kanaler</button>
              <button id="show-create-channel-btn" type="button">+ Ny kanal</button>
            </div>
            
            <div id="channel-selector" style="display: none;">
              <label for="existing-channels">Velg eksisterende kanal:</label>
              <select id="existing-channels" size="5" style="width: 100%; padding: 8px;">
                <option value="">-- Velg kanal --</option>
              </select>
            </div>

            <div id="create-channel-form" style="display: none; margin-top: 15px;">
              <h3 style="margin-top: 0;">Opprett ny kanal</h3>
              <label for="session-title">Tittel (p친krevd):</label>
              <input 
                type="text" 
                id="session-title" 
                placeholder="Eksempel: Italia Sommer 2024"
                required
              />
              <label for="session-description" style="margin-top: 10px;">Beskrivelse (valgfritt):</label>
              <textarea 
                id="session-description" 
                rows="3"
                placeholder="Beskrivelse av importen..."
              ></textarea>
              <button id="create-channel-btn" type="button" style="margin-top: 10px;">Opprett kanal</button>
            </div>

            <div id="selected-channel-info" style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px; display: none;">
              <strong>Valgt kanal:</strong> <span id="selected-channel-name"></span>
            </div>
          </div>
          <p class="info-text">游닞 Bildene vil automatisk knyttes til deg som fotograf</p>
        </div>

        <div class="section">
          <h2>3. Import-modus</h2>
          <div class="controls">
            <label>Velg hvordan filer skal h친ndteres:</label>
            <div style="margin: 15px 0;">
              <label style="display: block; margin-bottom: 10px;">
                <input type="radio" name="import-mode" value="copy" checked>
                <strong>Kopier fra midlertidig lokasjon</strong> (f.eks. SD-kort)
                <p style="margin: 5px 0 0 25px; color: #666; font-size: 0.9em;">
                  Filer kopieres til permanent lagring. Velg destinasjonskatalog nedenfor.
                </p>
              </label>
              <label style="display: block;">
                <input type="radio" name="import-mode" value="register">
                <strong>Registrer p친 eksisterende lokasjon</strong> (f.eks. NAS, arkiv)
                <p style="margin: 5px 0 0 25px; color: #666; font-size: 0.9em;">
                  Filer blir v칝rende der de er. Ingen kopiering.
                </p>
              </label>
            </div>

            <div id="copy-destination" style="margin-top: 15px;">
              <label for="destination-path">Destinasjonskatalog:</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input 
                  type="text" 
                  id="destination-path" 
                  placeholder="/home/user/photos/2025"
                  style="flex: 1;"
                  readonly
                />
                <button id="select-destination-btn" type="button">Velg katalog...</button>
              </div>
              <p class="info-text">游 Velg hvor filene skal kopieres til</p>
            </div>

            <div id="register-info" style="display: none; margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 4px;">
              <p style="margin: 0;"><strong>游늬 Register-modus:</strong> Filer blir v칝rende p친 sin n친v칝rende lokasjon. S칮rg for at lagringen er permanent (ikke SD-kort).</p>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>4. Velg Katalog</h2>
          <div class="controls">
            <button id="select-dir">Velg katalog med bilder</button>
            <span id="selected-dir"></span>
          </div>
          <div id="file-list" style="display: none;">
            <h3>Funnet filer:</h3>
            <div id="files"></div>
          </div>
        </div>

        <div class="section">
          <h2>5. Start Import</h2>
          <div class="controls">
            <button id="start-import" disabled>Start Import</button>
          </div>
        </div>

        <div id="status"></div>
        
        <div id="progress" style="display: none;">
          <h2>Import Progress</h2>
          <div class="progress-bar">
            <div id="progress-fill"></div>
          </div>
          <div id="progress-text"></div>
        </div>

        <div id="results" style="display: none;">
          <h2>Import Results</h2>
          <div id="results-content"></div>
        </div>
      </div>
    </main>
  </body>
</html>
