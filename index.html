<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imalink Desktop</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <main class="container">
      <h1>Imalink Desktop</h1>
      <p>Batch import av bilder til Imalink backend via imalink-core</p>

      <!-- Login Screen -->
      <div id="login-screen" style="display: none;">
        <div class="section">
          <h2>Logg inn</h2>
          <form id="login-form">
            <div class="controls">
              <label for="backend-url">Imalink Backend URL:</label>
              <input 
                type="text" 
                id="backend-url" 
                value="https://api.trollfjell.com" 
                placeholder="https://api.trollfjell.com"
              />
            </div>
            <div class="controls">
              <label for="login-username">Brukernavn:</label>
              <input 
                type="text" 
                id="login-username" 
                placeholder="brukernavn"
                autocomplete="username"
                required
              />
            </div>
            <div class="controls">
              <label for="login-password">Passord:</label>
              <input 
                type="password" 
                id="login-password" 
                placeholder="passord"
                autocomplete="current-password"
                required
              />
            </div>
            <div class="controls">
              <button type="submit" id="login-btn">Logg inn</button>
            </div>
            <div id="login-status"></div>
            <div class="auth-toggle">
              <p>Har du ikke konto? <a href="#" id="show-register">Registrer deg her</a></p>
            </div>
          </form>
        </div>

        <div class="section">
          <h2>Registrer ny bruker</h2>
          <form id="register-form" style="display: none;">
            <div class="controls">
              <label for="register-username">Brukernavn:</label>
              <input 
                type="text" 
                id="register-username" 
                placeholder="brukernavn"
                autocomplete="username"
                required
              />
            </div>
            <div class="controls">
              <label for="register-email">E-post:</label>
              <input 
                type="email" 
                id="register-email" 
                placeholder="din@epost.no"
                autocomplete="email"
                required
              />
            </div>
            <div class="controls">
              <label for="register-password">Passord:</label>
              <input 
                type="password" 
                id="register-password" 
                placeholder="passord"
                autocomplete="new-password"
                required
              />
            </div>
            <div class="controls">
              <label for="register-displayname">Visningsnavn:</label>
              <input 
                type="text" 
                id="register-displayname" 
                placeholder="Ditt Navn"
                required
              />
            </div>
            <div class="controls">
              <button type="submit" id="register-btn">Registrer bruker</button>
            </div>
            <div id="register-status"></div>
            <div class="auth-toggle">
              <p>Har du allerede konto? <a href="#" id="show-login">Logg inn her</a></p>
            </div>
          </form>
        </div>
      </div>

      <!-- Main Screen (after login) -->
      <div id="main-screen" style="display: none;">
        <div class="section">
          <div class="user-header">
            <span id="user-info"></span>
            <button id="open-gallery-btn" class="gallery-btn">游닞 칀pne Galleri</button>
            <button id="logout-btn" class="logout-btn">Logg ut</button>
          </div>
        </div>

        <div class="section">
          <h2>1. API Konfiguration</h2>
          <div class="controls">
            <label for="core-url">imalink-core API URL:</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input 
                type="text" 
                id="core-url" 
                value="http://localhost:8765" 
                placeholder="http://localhost:8765"
                style="flex: 1;"
              />
              <button id="test-core-btn" type="button">Test tilkobling</button>
            </div>
            <p id="core-status" class="info-text">imalink-core startes automatisk ved oppstart av appen</p>
          </div>
        </div>

        <div class="section">
          <h2>2. Input Channel</h2>
          <div class="controls">
            <label>Velg eksisterende eller opprett ny:</label>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button id="load-channels-btn" type="button">Last inn kanaler</button>
              <button id="show-create-channel-btn" type="button">+ Ny kanal</button>
            </div>
            
            <div id="channel-selector" style="display: none;">
              <label for="existing-channels">Velg eksisterende kanal:</label>
              <select id="existing-channels" size="5" style="width: 100%; padding: 8px;">
                <option value="">-- Velg kanal --</option>
              </select>
            </div>

            <div id="create-channel-form" style="display: none; margin-top: 15px;">
              <h3 style="margin-top: 0;">Opprett ny kanal</h3>
              <label for="session-title">Tittel (p친krevd):</label>
              <input 
                type="text" 
                id="session-title" 
                placeholder="Eksempel: Italia Sommer 2024"
                required
              />
              <label for="session-description" style="margin-top: 10px;">Beskrivelse (valgfritt):</label>
              <textarea 
                id="session-description" 
                rows="3"
                placeholder="Beskrivelse av importen..."
              ></textarea>
              <button id="create-channel-btn" type="button" style="margin-top: 10px;">Opprett kanal</button>
            </div>

            <div id="selected-channel-info" style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px; display: none;">
              <strong>Valgt kanal:</strong> <span id="selected-channel-name"></span>
            </div>
          </div>
          <p class="info-text">游닞 Bildene vil automatisk knyttes til deg som fotograf</p>
        </div>

        <div class="section">
          <h2>3. Import-modus</h2>
          <div class="controls">
            <label style="font-weight: bold; display: block; margin-bottom: 8px;">Velg hvordan filer skal h친ndteres:</label>
            
            <!-- REGISTER MODE (default) -->
            <div style="margin-bottom: 10px; padding: 10px; border: 2px solid #2196F3; border-radius: 8px; background: #E3F2FD;">
              <label style="display: block; cursor: pointer;">
                <input type="radio" name="import-mode" value="register" checked>
                <strong style="font-size: 1.1em;">游늬 Registrer fra n친v칝rende lokasjon</strong>
              </label>
              <p style="margin: 5px 0 10px 25px; color: #333; line-height: 1.4;">
                Brukes for bilder som allerede ligger p친 permanent lagring (NAS, harddisk, arkiv).<br>
                Ingen filer kopieres - de blir v칝rende der de er.
              </p>
              <div id="register-source" style="margin-left: 25px;">
                <label for="register-source-path" style="display: block; margin-bottom: 5px; font-weight: bold;">Velg katalog med bilder:</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                  <input 
                    type="text" 
                    id="register-source-path" 
                    placeholder="/mnt/nas/photos/2025"
                    style="flex: 1; padding: 8px;"
                    readonly
                  />
                  <button id="select-register-source-btn" type="button" style="padding: 8px 15px;">Velg katalog...</button>
                </div>
              </div>
            </div>

            <!-- COPY MODE -->
            <div style="padding: 10px; border: 2px solid #ccc; border-radius: 8px; background: #f5f5f5;">
              <label style="display: block; cursor: pointer;">
                <input type="radio" name="import-mode" value="copy">
                <strong style="font-size: 1.1em;">游 Kopier fra midlertidig lokasjon</strong>
              </label>
              <p style="margin: 5px 0 10px 25px; color: #666; line-height: 1.4;">
                Brukes for bilder p친 SD-kort, USB-stick eller annen midlertidig lagring.<br>
                Filene kopieres til permanent destinasjon.
              </p>
              <div id="copy-settings" style="margin-left: 25px; display: none;">
                <div style="margin-bottom: 10px;">
                  <label for="copy-source-path" style="display: block; margin-bottom: 5px; font-weight: bold;">Kilde (midlertidig):</label>
                  <div style="display: flex; gap: 10px; align-items: center;">
                    <input 
                      type="text" 
                      id="copy-source-path" 
                      placeholder="/media/kjell/SD-CARD"
                      style="flex: 1; padding: 8px;"
                      readonly
                    />
                    <button id="select-copy-source-btn" type="button" style="padding: 8px 15px;">Velg katalog...</button>
                  </div>
                </div>
                <div>
                  <label for="destination-path" style="display: block; margin-bottom: 5px; font-weight: bold;">Destinasjon (permanent):</label>
                  <div style="display: flex; gap: 10px; align-items: center;">
                    <input 
                      type="text" 
                      id="destination-path" 
                      placeholder="/home/kjell/photos/2025"
                      style="flex: 1; padding: 8px;"
                      readonly
                    />
                    <button id="select-destination-btn" type="button" style="padding: 8px 15px;">Velg katalog...</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <h2>4. Filinfo</h2>
          <div id="file-list" style="display: none;">
            <h3>Funnet filer:</h3>
            <div id="files"></div>
          </div>
        </div>

        <div class="section">
          <h2>5. Start Import</h2>
          <div class="controls">
            <button id="start-import" disabled>Start Import</button>
          </div>
        </div>

        <div id="status"></div>
        
        <div id="progress" style="display: none;">
          <h2>Import Progress</h2>
          <div class="progress-bar">
            <div id="progress-fill"></div>
          </div>
          <div id="progress-text"></div>
        </div>

        <div id="results" style="display: none;">
          <h2>Import Results</h2>
          <div id="results-content"></div>
        </div>
      </div>
    </main>
  </body>
</html>
